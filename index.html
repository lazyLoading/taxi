<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="author" content="">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/jquery-1.11.0.min.js"></script>


</head>
<body>
<h1 class="header w"><a href="#"></a><p>支付订单</p><span></span></h1>
<div class="pay-main">
    <div class="text clearfix">
        <img class="fl" src="img/ic-succ.png">
			<span class="fl">感谢您成功支付订单<br/>待订单审核通过后，坐等收货<br/>
				<em class="time"></em>
			</span>
    </div>
    <div class="ic-bao"><img class="fl" src="img/logo.png"></div>
    <div class="bnt">
        <a class="sub-share" id="sub-share" href="#">分享有钱</a>
        <a href="index.htm">继续购物</a>
        <!--<a href="#">查看订单</a>-->
    </div>
    <div class="rule">
        <h3>分享有奖活动规则</h3>

        <div>
            <img src="img/ic-top.png"/>
            <div id="rule-content">
                <!--<li>如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝如何获取钱宝</li>-->
            </div>

        </div>

    </div>
</div>
<div class="msgTip" style="display: none">该功能暂仅支持钱宝APP，请去APP Store下载</div>

<script>
    var wlanUrl = "http://m.qbao.com/api/route/bcwap/";
    var u = navigator.userAgent, app = navigator.appVersion;
    var isAndroid = u.indexOf('Android') > -1 || u.indexOf('android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
    var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
    var noApp = u.indexOf('Safari') > -1 || u.indexOf('UCBrowser') > -1 || u.indexOf('MicroMessenger') > -1;

    var share_imgUrl, share_title, share_des, share_url;

    function shareEquipment(data) {

        share_imgUrl = data.share_imgUrl;
        share_title = data.share_title;
        share_des = data.share_des;
        share_url = data.share_url;

        if (isAndroid) {
            if (!window.QBaoJSBridge) {
                window.QBaoJSBridge = {};
                window.QBaoJSBridge.on = function (param1, param2) {
                };
                window.QBaoJSBridge.invoke = function (param1, param2) {
                };
            }
            var handler = function () {
                QBaoJSBridge.invoke('shareTimeline', JSON.stringify({
                    "title": share_title,
                    "img_url": share_imgUrl,
                    "img_width": "640",
                    "img_height": "640",
                    "url": share_url,
                    "description": share_des
                }));
            }
            var handler2 = function () {
                QBaoJSBridge.invoke('collect', JSON.stringify({
                    "title": share_title,
                    "img_url": share_imgUrl,
                    "img_width": "640",
                    "img_height": "640",
                    "url": share_url,
                    "description": share_des
                }));
            }
            QBaoJSBridge.on("menu:share:timeline", String(handler));
            QBaoJSBridge.on("menu:collect:timeline", String(handler2));
        }

        //如果是IOS并且不是网页，调用客户端
        if (isiOS && !noApp) {
            window.location.href = "qbao://app/baogou/callback?" + JSON.stringify({
                        "title": share_title,
                        "desc": share_des,
                        "url": share_url,
                        "pic": share_imgUrl
                    });

        }
        //点击按钮判断安卓与IOS
        $('#sub-share').click(function () {
            if (isAndroid) {
                QBaoJSBridge.invoke('shareTimeline', JSON.stringify({
                    "title": share_title,
                    "img_url": share_imgUrl,
                    "img_width": "640",
                    "img_height": "640",
                    "url": share_url,
                    "description": share_des
                }));
            }
            if (isiOS) {
                window.location.href = "qbao://app/baogou/shareProduct?" + JSON.stringify({
                            "title": share_title,
                            "desc": share_des,
                            "url": share_url,
                            "pic": share_imgUrl
                        });
            }

            tipMsg("该功能暂仅支持钱宝APP，请去APP Store下载");

        });

    }
    //分享提示
    function tipMsg(text) {
        var tip = $(".msgTip");
        tip.text(text);
        var w = parseInt($(window).width());
        var t = parseInt(tip.width());
        tip.css("margin-left", ((w - t) / 2) - 12 + "px");
        tip.stop(true, true).fadeIn('slow').fadeOut(5000);
    }
    ;

    signup = {
        //倒计时
        countDown: function () {
            var _deadline = new Date(signup.deadline).getTime();
            var _now = new Date().getTime();

            if (parseInt(_now) < parseInt(_deadline)) {
                var time_start = new Date().getTime(); //设定当前时间
                var time_end = new Date(signup.deadline).getTime(); //设定目标时间

                // 计算时间差
                var time_distance = time_end - time_start;
                // 天
                var int_day = Math.floor(time_distance / 86400000)
                time_distance -= int_day * 86400000;
                // 时
                var int_hour = Math.floor(time_distance / 3600000)
                time_distance -= int_hour * 3600000;
                // 分
                var int_minute = Math.floor(time_distance / 60000)
                time_distance -= int_minute * 60000;
                // 秒
                var int_second = Math.floor(time_distance / 1000)

                // 时分秒为单数时、前面加零
                if (int_day < 10) {
                    int_day = "0" + int_day;
                }
                if (int_hour < 10) {
                    int_hour = "0" + int_hour;
                }
                if (int_minute < 10) {
                    int_minute = "0" + int_minute;
                }
                if (int_second < 10) {
                    int_second = "0" + int_second;
                }

                var tips = "有效分享时间：";
                if (int_day > 0)
                    tips += int_day + "天";
                if (int_hour > 0)
                    tips += int_hour + "小时";
                if (int_minute > 0)
                    tips += int_minute + "分";
                if (int_second > 0)
                    tips += int_second + "秒";
                $(".time").html(tips);

                // 设置定时器
                setTimeout(signup.countDown, 1000);
            }
        }
    };

    function changDataFormat(_old) {
        var year = _old.split(' ')[0].split('-')[0];
        var month = _old.split(' ')[0].split('-')[1];
        var day = _old.split(' ')[0].split('-')[2];
        var hour = _old.split(' ')[1].split(':')[0];
        var min = _old.split(' ')[1].split(':')[1];
        var second = _old.split(' ')[1].split(':')[2];
        return month + '/' + day + '/' + year + ' ' + hour + ':' + min + ':' + second;

    }


    $(function () {
        var orderId = get_url_parames().orderId;
        if(!orderId){
            return;
        }

        $.zajaxV2({
            postArr: [
                {func: "init", url: wlanUrl + "sharePurchase/init/" + orderId + ".html"}
            ],
            successFunc: function(json){
                var proof = json.init.data;
                if(json.init.errorCode == "1000005"){
                    window.location.href="index.htm";
                }
                $.zajaxV2({
                    postArr: [
                        {func: "detail", url: wlanUrl + "sharePurchase/detail/" + proof + ".html", type: "GET"}
                    ],
                    successFunc: function(json){
                        var detail = json.detail.data;

                        //倒计时调用
                        var format = new SimpleDateFormat("YYYY-MM-DD hh:mm:ss");
                        var endTime = format.parse(detail.endTime).getTime();
                        var _now = new Date().getTime();

                        if (parseInt(_now) < parseInt(endTime)) {
                            signup.deadline = changDataFormat(detail.endTime);
                            signup.countDown();
                        }

                        var rule = detail.sharePurchaseRule;p
                        $(".rule #rule-content").html(rule);

                        var shareDesc = "我在钱宝购买了\"" + detail.productName + "\" ，快来帮我助力领宝券吧！";
                        var data = {
                            share_title: detail.productName,
                            share_imgUrl: detail.productPicUrls[0],
                            share_url: detail.wapShareUrl,
                            share_des: shareDesc
                        }
                        shareEquipment(data);
                    }
                });

            }
        });

        /*$.ajax({
            type: "GET",
            url: wlanUrl + "sharePurchase/init/" + orderId + ".html",
            dataType: "json",
            contentType: 'application/json;charset=UTF-8',
            success: function (resp) {
                var proof = resp.data;
                $.ajax({
                    type: "GET",
                    url: wlanUrl + "sharePurchase/detail/" + proof + ".html",
                    dataType: "json",
                    contentType: 'application/json;charset=UTF-8',
                    success: function (resp) {
                        var share = resp.data;
                        $.ajax({
                            type: "GET",
                            url: wlanUrl + "tuan/info.html?productId=" + share.productId,
                            dataType: "json",
                            success: function (resp) {
                                var product = resp.data;
                                //倒计时调用
                                var _oldDate = new Date(product.endTime);
                                var _old = _oldDate.getFullYear() + "-" + _oldDate.getMonth() + '-' + _oldDate.getDate() + ' ' + _oldDate.getHours() + ':' + _oldDate.getMinutes() + ':' + _oldDate.getSeconds();
                                signup.deadline = changDataFormat(_old);
                                signup.countDown();

                                var data = {
                                    share_title: product.productName,
                                    share_imgUrl: product.productPicUrls[0],
                                    share_url: share.wapShareUrl,
                                    share_des: share.writtenDescption,
                                }
                                shareEquipment(data);
                            }
                        });
                    }

                });


            }
        });*/

    })
    var SimpleDateFormat = function(fmt){
        var positon = {
            "Y+": {h: Date.prototype.setFullYear}, //年
            "M+": {o:-1, h: Date.prototype.setMonth}, //月
            "D+": {h: Date.prototype.setDate}, //日
            "h+": {h: Date.prototype.setHours}, //时
            "m+": {h: Date.prototype.setMinutes}, //分
            "s+": {h: Date.prototype.setSeconds}  //秒
        };

        for(p in positon){
            var rst = new RegExp("(" + p + ")").exec(fmt);
            if(!rst){
                break;
            }
            var curr = positon[p];
            curr.b = rst.index;
            curr.l = rst[0].length;
        }

        this.parse = function(str){
            var date = new Date();
            for(p in positon){
                var curr = positon[p];
                if(curr.b && curr.l){
                    var val = str.slice(curr.b, curr.b + curr.l);
                    if(isNaN(val)){
                        throw new TypeError(val + " is not a number");
                    }
                    var o = curr.o ? curr.o : 0;
                    curr.h.call(date, parseInt(val) + o);
                }
            }
            return date;
        }
    }
</script>
</body>
</html>